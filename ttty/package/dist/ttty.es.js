const n=(n,t,e)=>{const s=document.createElement(n);return t&&(s.className=t),e&&(s.innerHTML=e),s},t=(n,t=!1)=>{n.input.readOnly=!t,n.inputContainer.style.opacity=t?"":"0"};var e,s;(s=e||(e={})).ON_COMMAND="onCommand",s.ON_COMMAND_NOT_FOUND="onCommand404",s.ON_PROCESS_START="onProcessStart",s.ON_PROCESS_END="onProcessStop",s.ON_PROCESS_INTERRUPT="onProcessInterrupt",s.ON_INIT="onInit";const o=(n,t,e)=>{const s=new CustomEvent(n,{detail:e});t.dispatchEvent(s)},i=(n,t)=>{const{print:s}=t,i=n.split(" "),r=i[0],a=i.slice(1),c=t.settings.commands[r];c?c.argDescriptions&&c.argDescriptions.length>0&&0===a.length?s(`Usage: ${r} ${c.argDescriptions.map((n=>`[${n}]`)).join(" ")}`):(c.func(t,...a),o(e.ON_COMMAND,t.settings.host,n)):(s(`<span class="terminal-error">command not found: ${r}</span>`),o(e.ON_COMMAND_NOT_FOUND,t.settings.host,n))},r=n=>{const{settings:{host:s}}=n;t(n),n.isProcessRunning=!0,o(e.ON_PROCESS_START,s)},a=n=>{const{input:s,settings:{host:i}}=n;t(n,!0),n.isProcessRunning=!1,s.focus(),o(e.ON_PROCESS_END,i)},c=(n,t)=>{const{history:e,lastHistoryIndex:s}=n,o=e.length-1;let i;t&&0===s||(t||s!==e.length)&&(o<0||(t?(i=s-1,n.input.value=i-1>=0?e[i-1]:""):(i=s+1,n.input.value=e[s]),n.lastHistoryIndex=i))},p=({host:t,welcomeMessage:s,prompt:p="$: ",historyLength:l=50,enableHelp:m=!0,commands:u})=>{const d={host:t,welcomeMessage:s,prompt:p,historyLength:l,enableHelp:m,commands:u},{commandContainer:g,input:h,inputContainer:O}=((t,e)=>{t.className="terminal";const s=n("div","terminal-container"),o=n("div","terminal-type"),i=n("span",void 0,e),r=n("input");return r.setAttribute("type","text"),o.append(i),o.append(r),t.append(s),t.append(o),t.addEventListener("click",(()=>r.focus())),{commandContainer:s,input:r,inputContainer:o}})(t,p),N={history:[],lastHistoryIndex:0,isProcessRunning:!1,settings:d,commandContainer:g,inputContainer:O,input:h,print:(t,e=!1)=>((t,e,s,o,i)=>{const r=n("p",void 0,e?i:t);if(e){const e=n("span","termainal-command",t);r.append(e)}s.append(r),o.scrollIntoView()})(t,e,g,h,p),run:n=>i(n,N),start:()=>r(N),stop:()=>a(N),type:(t,e=60,s)=>((t,e,s,o)=>{r(s);const i=n("p");s.commandContainer.append(i);let c=0;const p=()=>{c<t.length&&s.isProcessRunning?(i.innerHTML+=t.charAt(c),c++,setTimeout(p,e)):(o&&o(),a(s))};setTimeout(p,e)})(t,e,N,s)};return m&&(N.settings.commands.help=(n=>({name:"help",description:"shows a full list of all available commands",func:({print:t})=>{for(const e in n.settings.commands)Object.hasOwnProperty.call(n.settings.commands,e)&&t(n.settings.commands[e].name+" - "+n.settings.commands[e].description)}}))(N)),((n,t)=>{const{input:s,print:r}=t;n.addEventListener("keyup",(({key:p,ctrlKey:l})=>{if(l&&"c"===p&&t.isProcessRunning)r("^C"),a(t),o(e.ON_PROCESS_INTERRUPT,n);else{if(t.isProcessRunning)return;if("Enter"===p)return t.lastHistoryIndex=0,s.value.length>0?(r(s.value,!0),(n=>{const{input:{value:t},history:e,settings:{historyLength:s}}=n;t!==e[0]&&(e.length>=s?n.history=[t,...e.slice(0,-1)]:(n.history=[t,...e],n.lastHistoryIndex=0))})(t),i(s.value,t)):r(" ",!0),void(s.value="");if("ArrowUp"===p)return void c(t);"ArrowDown"===p&&c(t,!0)}}))})(t,N),o(e.ON_INIT,t),s&&N.print(s),N};export{p as initTerminal};
